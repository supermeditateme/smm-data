{"version":3,"file":"data.js","sources":["../../../../js/lib/reducers/data.js"],"sourcesContent":["// WARNING! Care should be taken with this section of application: rawValues[],\n// derivedValues[] and onScreenCoordinates[] arrays are modified IN-PLACE, and\n// so will not work properly in selectors or PureComponents that consume these\n// arrays directly.\n\nimport {\n  ADD_DATA_SEGMENT_30S,\n  ADD_DERIVED_SEGMENT_30S,\n  ADD_COORDINATES_SEGMENT_30S,\n  REMOVE_DATA_SEGMENT_30S,\n} from '../actions/data';\nimport { SET_HEADER } from '../actions/header';\n\nconst initialState = {\n  rawValues: [],\n  derivedValues: [],\n  onScreenCoordinates: [],\n};\n\nfunction dataReducer(state = initialState, action) {\n  let newState;\n  const { type, payload } = action;\n\n  switch (type) {\n    case SET_HEADER:\n      // When header changes, we invalidate all our data.\n      const size = Math.ceil(\n        payload.header.dataRecordsNumber *\n          payload.header.dataRecordDuration /\n          30\n      );\n      newState = {\n        rawValues: new Array(size).fill(null),\n        derivedValues: new Array(size).fill(null),\n        onScreenCoordinates: new Array(size).fill(null),\n      };\n      return newState;\n\n    case ADD_DATA_SEGMENT_30S:\n      if (process.env.NODE_ENV === 'development') {\n        checkSegmentPayload(payload, state.rawValues.length);\n      }\n\n      newState = { ...state };\n      newState.rawValues[payload.index] = payload.data;\n\n      return newState;\n\n    case REMOVE_DATA_SEGMENT_30S:\n      newState = { ...state };\n      newState.rawValues[payload.index] = null;\n      newState.derivedValues[payload.index] = null;\n      newState.onScreenCoordinates[payload.index] = null;\n      return newState;\n\n    case ADD_DERIVED_SEGMENT_30S:\n      if (process.env.NODE_ENV === 'development') {\n        checkSegmentPayload(payload, state.rawValues.length);\n      }\n\n      newState = { ...state };\n      newState.derivedValues[payload.index] = payload.data;\n      if (process.env.NODE_ENV === 'development') {\n        if (!newState.rawValues[payload.index]) {\n          console.warn('Setting derived values when raw values are not present; this may be the sign of a bug');\n        }\n      }\n      return newState;\n\n    case ADD_COORDINATES_SEGMENT_30S:\n      if (process.env.NODE_ENV === 'development') {\n        checkSegmentPayload(payload, state.rawValues.length);\n      }\n\n      newState = { ...state };\n      newState.onScreenCoordinates[payload.index] = payload.data;\n      if (process.env.NODE_ENV === 'development') {\n        if (!newState.rawValues[payload.index] || !newState.derivedValues[payload.index]) {\n          console.warn('Setting coordinates values when raw values and/or derived values are not present; this may be the sign of a bug');\n        }\n      }\n      return newState;\n\n    default:\n      return state;\n  }\n}\n\nfunction checkSegmentPayload(payload, len) {\n  if (payload.index >= len) {\n    console.warn('Payload index out of range!');\n  }\n  if (!payload.data) {\n    console.warn('No payload data!');\n  }\n}\n\nexport default dataReducer;\n"],"names":["initialState","dataReducer","state","action","newState","type","payload","SET_HEADER","size","Math","ceil","header","dataRecordsNumber","dataRecordDuration","Array","fill","ADD_DATA_SEGMENT_30S","process","env","NODE_ENV","rawValues","length","index","data","REMOVE_DATA_SEGMENT_30S","derivedValues","onScreenCoordinates","ADD_DERIVED_SEGMENT_30S","warn","ADD_COORDINATES_SEGMENT_30S","checkSegmentPayload","len"],"mappings":";;;;;;;AAaA,IAAMA,eAAe;aACR,EADQ;iBAEJ,EAFI;uBAGE;CAHvB;;AAMA,SAASC,WAAT,GAAmD;MAA9BC,KAA8B,uEAAtBF,YAAsB;MAARG,MAAQ;;MAC7CC,iBAAJ;MACQC,IAFyC,GAEvBF,MAFuB,CAEzCE,IAFyC;MAEnCC,OAFmC,GAEvBH,MAFuB,CAEnCG,OAFmC;;;UAIzCD,IAAR;SACOE,oBAAL;;UAEQC,OAAOC,KAAKC,IAAL,CACXJ,QAAQK,MAAR,CAAeC,iBAAf,GACEN,QAAQK,MAAR,CAAeE,kBADjB,GAEE,EAHS,CAAb;iBAKW;mBACE,IAAIC,KAAJ,CAAUN,IAAV,EAAgBO,IAAhB,CAAqB,IAArB,CADF;uBAEM,IAAID,KAAJ,CAAUN,IAAV,EAAgBO,IAAhB,CAAqB,IAArB,CAFN;6BAGY,IAAID,KAAJ,CAAUN,IAAV,EAAgBO,IAAhB,CAAqB,IAArB;OAHvB;aAKOX,QAAP;;SAEGY,8BAAL;UACMC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;4BACtBb,OAApB,EAA6BJ,MAAMkB,SAAN,CAAgBC,MAA7C;;;8BAGcnB,KAAhB;eACSkB,SAAT,CAAmBd,QAAQgB,KAA3B,IAAoChB,QAAQiB,IAA5C;;aAEOnB,QAAP;;SAEGoB,iCAAL;8BACkBtB,KAAhB;eACSkB,SAAT,CAAmBd,QAAQgB,KAA3B,IAAoC,IAApC;eACSG,aAAT,CAAuBnB,QAAQgB,KAA/B,IAAwC,IAAxC;eACSI,mBAAT,CAA6BpB,QAAQgB,KAArC,IAA8C,IAA9C;aACOlB,QAAP;;SAEGuB,iCAAL;UACMV,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;4BACtBb,OAApB,EAA6BJ,MAAMkB,SAAN,CAAgBC,MAA7C;;;8BAGcnB,KAAhB;eACSuB,aAAT,CAAuBnB,QAAQgB,KAA/B,IAAwChB,QAAQiB,IAAhD;UACIN,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;YACtC,CAACf,SAASgB,SAAT,CAAmBd,QAAQgB,KAA3B,CAAL,EAAwC;kBAC9BM,IAAR,CAAa,uFAAb;;;aAGGxB,QAAP;;SAEGyB,qCAAL;UACMZ,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;4BACtBb,OAApB,EAA6BJ,MAAMkB,SAAN,CAAgBC,MAA7C;;;8BAGcnB,KAAhB;eACSwB,mBAAT,CAA6BpB,QAAQgB,KAArC,IAA8ChB,QAAQiB,IAAtD;UACIN,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;YACtC,CAACf,SAASgB,SAAT,CAAmBd,QAAQgB,KAA3B,CAAD,IAAsC,CAAClB,SAASqB,aAAT,CAAuBnB,QAAQgB,KAA/B,CAA3C,EAAkF;kBACxEM,IAAR,CAAa,iHAAb;;;aAGGxB,QAAP;;;aAGOF,KAAP;;;;AAIN,SAAS4B,mBAAT,CAA6BxB,OAA7B,EAAsCyB,GAAtC,EAA2C;MACrCzB,QAAQgB,KAAR,IAAiBS,GAArB,EAA0B;YAChBH,IAAR,CAAa,6BAAb;;MAEE,CAACtB,QAAQiB,IAAb,EAAmB;YACTK,IAAR,CAAa,kBAAb;;;;;;"}