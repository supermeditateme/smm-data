{"version":3,"file":"funnelBuffer.js","sources":["../../../../../js/lib/core/edf/funnelBuffer.js"],"sourcesContent":["export default class FunnelBuffer {\n  constructor(stream) {\n    this.stream = stream;\n    this.buffer = new Uint8Array();\n  }\n\n  read(size) {\n    if (size > this.buffer.length) {\n      return this._readFromStream(size, 0);\n    } else {\n      return this._readFromBuffer(size);\n    }\n  }\n\n  _readFromStream(size, fuse) {\n    if (fuse > 1000) throw 'Recursion level too deep';\n\n    return this.stream.read().then(({ done, value }) => {\n      if (done)\n        return new Promise(resolve => resolve({ done: true, value: null }));\n      this._pushToBuffer(value);\n      if (this.buffer.length < size)\n        return this._readFromStream(size, fuse + 1);\n      return this._readFromBuffer(size);\n    });\n  }\n\n  _pushToBuffer(values) {\n    let newBuffer = new Uint8Array(this.buffer.length + values.length);\n    newBuffer.set(this.buffer, 0);\n    newBuffer.set(values, this.buffer.length);\n    this.buffer = newBuffer;\n  }\n\n  _readFromBuffer(size) {\n    const value = this.buffer.slice(0, size);\n    this.buffer = this.buffer.slice(size);\n    return new Promise(resolve => resolve({ done: false, value: value }));\n  }\n}\n"],"names":["FunnelBuffer","stream","buffer","Uint8Array","size","length","_readFromStream","_readFromBuffer","fuse","read","then","done","value","Promise","resolve","_pushToBuffer","values","newBuffer","set","slice"],"mappings":";;;;IAAqBA;wBACPC,MAAZ,EAAoB;;;SACbA,MAAL,GAAcA,MAAd;SACKC,MAAL,GAAc,IAAIC,UAAJ,EAAd;;;;;yBAGGC,MAAM;UACLA,OAAO,KAAKF,MAAL,CAAYG,MAAvB,EAA+B;eACtB,KAAKC,eAAL,CAAqBF,IAArB,EAA2B,CAA3B,CAAP;OADF,MAEO;eACE,KAAKG,eAAL,CAAqBH,IAArB,CAAP;;;;;oCAIYA,MAAMI,MAAM;;;UACtBA,OAAO,IAAX,EAAiB,MAAM,0BAAN;;aAEV,KAAKP,MAAL,CAAYQ,IAAZ,GAAmBC,IAAnB,CAAwB,gBAAqB;YAAlBC,IAAkB,QAAlBA,IAAkB;YAAZC,KAAY,QAAZA,KAAY;;YAC9CD,IAAJ,EACE,OAAO,IAAIE,OAAJ,CAAY;iBAAWC,QAAQ,EAAEH,MAAM,IAAR,EAAcC,OAAO,IAArB,EAAR,CAAX;SAAZ,CAAP;cACGG,aAAL,CAAmBH,KAAnB;YACI,MAAKV,MAAL,CAAYG,MAAZ,GAAqBD,IAAzB,EACE,OAAO,MAAKE,eAAL,CAAqBF,IAArB,EAA2BI,OAAO,CAAlC,CAAP;eACK,MAAKD,eAAL,CAAqBH,IAArB,CAAP;OANK,CAAP;;;;kCAUYY,QAAQ;UAChBC,YAAY,IAAId,UAAJ,CAAe,KAAKD,MAAL,CAAYG,MAAZ,GAAqBW,OAAOX,MAA3C,CAAhB;gBACUa,GAAV,CAAc,KAAKhB,MAAnB,EAA2B,CAA3B;gBACUgB,GAAV,CAAcF,MAAd,EAAsB,KAAKd,MAAL,CAAYG,MAAlC;WACKH,MAAL,GAAce,SAAd;;;;oCAGcb,MAAM;UACdQ,QAAQ,KAAKV,MAAL,CAAYiB,KAAZ,CAAkB,CAAlB,EAAqBf,IAArB,CAAd;WACKF,MAAL,GAAc,KAAKA,MAAL,CAAYiB,KAAZ,CAAkBf,IAAlB,CAAd;aACO,IAAIS,OAAJ,CAAY;eAAWC,QAAQ,EAAEH,MAAM,KAAR,EAAeC,OAAOA,KAAtB,EAAR,CAAX;OAAZ,CAAP;;;;;;;;;"}