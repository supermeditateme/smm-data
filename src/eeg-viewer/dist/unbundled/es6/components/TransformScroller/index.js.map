{"version":3,"file":"index.js","sources":["../../../../../js/lib/components/TransformScroller/index.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { STORE_KEY } from '../../constants';\nimport { getCurrentPosition, getFileDuration } from '../../selectors';\n\nimport {\n  setCurrentTime,\n  shiftCurrentTime,\n  setScrollerParams,\n} from '../../actions';\n\nclass TransformScroller extends PureComponent {\n  componentDidMount() {\n    const { dispatch, navigation: { currentTime } } = this.props;\n\n    this.resizeHandler();\n    dispatch(setCurrentTime(currentTime));\n\n    window.addEventListener('resize', this.resizeHandler, false);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.resizeHandler, false);\n  }\n\n  resizeHandler = () => {\n    this.props.dispatch(\n      setScrollerParams({\n        scrollerWidth: this.scroller.offsetWidth,\n        scrollerXPosition: this.scroller.getBoundingClientRect().x,\n      })\n    );\n  };\n\n  scrollHandler = e => {\n    const {\n      navigation: { epochSize },\n      presentation: { scrollerWidth },\n    } = this.props;\n\n    let delta = e.deltaX || e.deltaY;\n\n    if (e.deltaMode === 1) {\n      // DOM_DELTA_LINE mode of scrolling; currently only Firefox does that\n      // see https://github.com/cubiq/iscroll/issues/577#issuecomment-49095332\n\n      delta *= 20; // Just rule-of-thumb value.\n    }\n\n    let direction = -1;\n\n    const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n    if (macosPlatforms.includes(window.navigator.platform)) {\n      direction = 1;\n    }\n\n    const time = direction * delta * epochSize / scrollerWidth;\n\n    this.props.dispatch(shiftCurrentTime(time));\n  };\n\n  onKeyDown = e => {\n    const { epochSize } = this.props.navigation;\n\n    let direction = null;\n    if (e.key === 'ArrowRight') {\n      direction = 1;\n    } else if (e.key === 'ArrowLeft') {\n      direction = -1;\n    }\n    if (direction === null) return;\n\n    let duration = epochSize;\n    if (e.shiftKey) duration = 10;\n    if (e.ctrlKey) duration = 1;\n    if (e.shiftKey && e.ctrlKey) duration = 30;\n\n    this.props.dispatch(shiftCurrentTime(duration * direction));\n  };\n\n  onMouseOver = () =>\n    this.scroller.matches(':focus-within') || this.scroller.focus();\n\n  render() {\n    return (\n      <div\n        className=\"scroller  scroller__transform\"\n        onWheel={this.scrollHandler}\n        onMouseOver={this.onMouseOver}\n        ref={el => (this.scroller = el)}\n        tabIndex=\"0\"\n        onKeyDown={this.onKeyDown}\n      >\n        <div\n          style={{\n            transform: `translateX(${-this.props.currentPosition}px)`,\n          }}\n        >\n          {this.props.children}\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  ...state,\n  currentPosition: getCurrentPosition(state),\n  fileDuration: getFileDuration(state),\n});\n\nexport default connect(mapStateToProps, undefined, undefined, {\n  storeKey: STORE_KEY,\n})(TransformScroller);\n"],"names":["TransformScroller","resizeHandler","props","dispatch","setScrollerParams","scroller","offsetWidth","getBoundingClientRect","x","scrollHandler","epochSize","navigation","scrollerWidth","presentation","delta","e","deltaX","deltaY","deltaMode","direction","macosPlatforms","includes","window","navigator","platform","time","shiftCurrentTime","onKeyDown","key","duration","shiftKey","ctrlKey","onMouseOver","matches","focus","currentTime","setCurrentTime","addEventListener","removeEventListener","el","currentPosition","children","PureComponent","mapStateToProps","state","getCurrentPosition","getFileDuration","connect","undefined","STORE_KEY"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;IAYMA;;;;;;;;;;;;;;4MAcJC,gBAAgB,YAAM;YACfC,KAAL,CAAWC,QAAX,CACEC,kBAAkB;uBACD,MAAKC,QAAL,CAAcC,WADb;2BAEG,MAAKD,QAAL,CAAcE,qBAAd,GAAsCC;OAF3D,CADF;aAQFC,gBAAgB,aAAK;wBAIf,MAAKP,KAJU;UAEHQ,SAFG,eAEjBC,UAFiB,CAEHD,SAFG;UAGDE,aAHC,eAGjBC,YAHiB,CAGDD,aAHC;;;UAMfE,QAAQC,EAAEC,MAAF,IAAYD,EAAEE,MAA1B;;UAEIF,EAAEG,SAAF,KAAgB,CAApB,EAAuB;;;;iBAIZ,EAAT,CAJqB;;;UAOnBC,YAAY,CAAC,CAAjB;;UAEMC,iBAAiB,CAAC,WAAD,EAAc,UAAd,EAA0B,QAA1B,EAAoC,QAApC,CAAvB;UACIA,eAAeC,QAAf,CAAwBC,OAAOC,SAAP,CAAiBC,QAAzC,CAAJ,EAAwD;oBAC1C,CAAZ;;;UAGIC,OAAON,YAAYL,KAAZ,GAAoBJ,SAApB,GAAgCE,aAA7C;;YAEKV,KAAL,CAAWC,QAAX,CAAoBuB,iBAAiBD,IAAjB,CAApB;aAGFE,YAAY,aAAK;UACPjB,SADO,GACO,MAAKR,KAAL,CAAWS,UADlB,CACPD,SADO;;;UAGXS,YAAY,IAAhB;UACIJ,EAAEa,GAAF,KAAU,YAAd,EAA4B;oBACd,CAAZ;OADF,MAEO,IAAIb,EAAEa,GAAF,KAAU,WAAd,EAA2B;oBACpB,CAAC,CAAb;;UAEET,cAAc,IAAlB,EAAwB;;UAEpBU,WAAWnB,SAAf;UACIK,EAAEe,QAAN,EAAgBD,WAAW,EAAX;UACZd,EAAEgB,OAAN,EAAeF,WAAW,CAAX;UACXd,EAAEe,QAAF,IAAcf,EAAEgB,OAApB,EAA6BF,WAAW,EAAX;;YAExB3B,KAAL,CAAWC,QAAX,CAAoBuB,iBAAiBG,WAAWV,SAA5B,CAApB;aAGFa,cAAc;aACZ,MAAK3B,QAAL,CAAc4B,OAAd,CAAsB,eAAtB,KAA0C,MAAK5B,QAAL,CAAc6B,KAAd,EAD9B;;;;;;wCApEM;mBACgC,KAAKhC,KADrC;UACVC,QADU,UACVA,QADU;UACcgC,WADd,UACAxB,UADA,CACcwB,WADd;;;WAGblC,aAAL;eACSmC,eAAeD,WAAf,CAAT;;aAEOE,gBAAP,CAAwB,QAAxB,EAAkC,KAAKpC,aAAvC,EAAsD,KAAtD;;;;2CAGqB;aACdqC,mBAAP,CAA2B,QAA3B,EAAqC,KAAKrC,aAA1C,EAAyD,KAAzD;;;;6BA6DO;;;aAEL;;;qBACY,+BADZ;mBAEW,KAAKQ,aAFhB;uBAGe,KAAKuB,WAHpB;eAIO;mBAAO,OAAK3B,QAAL,GAAgBkC,EAAvB;WAJP;oBAKW,GALX;qBAMa,KAAKZ;;;;;mBAGP;yCACoB,CAAC,KAAKzB,KAAL,CAAWsC,eAArC;;;eAGItC,KAAL,CAAWuC;;OAdlB;;;;;EAzE4BC;;AA8FhC,IAAMC,kBAAkB,SAAlBA,eAAkB;sBACnBC,KADmB;qBAELC,mBAAmBD,KAAnB,CAFK;kBAGRE,gBAAgBF,KAAhB;;CAHhB;;AAMA,eAAeG,QAAQJ,eAAR,EAAyBK,SAAzB,EAAoCA,SAApC,EAA+C;YAClDC;CADG,EAEZjD,iBAFY,CAAf;;;;"}